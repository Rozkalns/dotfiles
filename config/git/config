# Git Configuration
# Include this in your global git config:
# git config --global include.path ~/.dotfiles/config/git/config
# Or symlink to ~/.config/git/config

[core]
	excludesfile = ~/.config/git/ignore
	editor = nvim
	filemode = false
	trustctime = false
	autocrlf = input
	untrackedCache = true
	pager = delta
	ignorecase = false

[pull]
	rebase = true

[push]
	default = simple
	followTags = true
	autoSetupRemote = true

[fetch]
	prune = true

[init]
	defaultBranch = main

[rerere]
	enabled = true

[rebase]
	autoStash = true
	instructionFormat = (%aN <%aE> @ %ar) %s

[grep]
	lineNumber = true

[status]
	submodulesummary = 1

[submodule]
	recurse = true

[diff]
	renames = copies
	indentHeuristic = true
	colorMoved = default

[merge]
	conflictstyle = diff3
	defaultToUpstream = true

[interactive]
	diffFilter = delta --color-only --features=interactive

[delta]
	navigate = true
	light = false
	line-numbers = true
	side-by-side = true

[delta "interactive"]
	keep-plus-minus-markers = false

[alias]
	# Shortcuts
	st = status
	co = checkout
	br = branch
	ci = commit
	amend = commit --amend --reuse-message=HEAD

	# Logs
	l = log --graph --abbrev-commit --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset'
	ll = log --graph --abbrev-commit --pretty=oneline

	# Diffs
	d = diff
	ds = -c delta.side-by-side=true diff

	# Useful commands
	undo = reset --soft HEAD^
	redo = reset --hard HEAD@{1}
	unstage = reset HEAD --
	last = log -1 HEAD
	contributors = shortlog --summary --numbered
	publish = push -u origin HEAD

	# Quick workflow
	save = "!git add -A && git commit -m 'SAVEPOINT'"
	wip = commit -am "WIP"

	# Safe force push (checks remote state first)
	pfl = "!f() { git push --force-with-lease=$(git rev-parse --abbrev-ref HEAD):${1:-@{u}}; }; f"

	# Find who to ask for PR review (shows authors of changed files)
	reviewers = "!git diff --name-only $(git merge-base --fork-point ${1:-main}).. | xargs -n 1 git blame -w -M --porcelain | grep '^author ' | sort | uniq -c | sort -nr | head -10"

	# Fuzzy branch switching (requires fzf)
	fsw = "!git branch -a | fzf | xargs git switch"

	# Clean up merged branches
	cleanup = "!git branch --merged | grep -v '\\*\\|main\\|master' | xargs -n 1 git branch -d"

[color]
	ui = auto
